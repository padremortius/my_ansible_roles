# Репо по управлению Alpine Linux

## Список ролей

- apps/compose-app
- base-config
- bootstrap-server
- docker
- sshd-with-ports
- test
- update-pkgs

## Роль apps/compose-app

В рамках данной роли реализовано:

- [x] Создание необходимых директорий на хосте для проекта
- [x] Формирование/обновление docker-compose.yml в коревой директории проекта из шаблона
- [x] Остановка сервиса и создание архивной копии директорий и файла docker-compose.yml
- [x] Удаление остановленных контейнеров и других неиспользуемых объектов
- [x] Загрузка обновленных контейнеров и запуск в режиме демона

## Роль base-config

В рамках данной роли реализовано:
[X] Создание/удаление новых пользователей
[X] Добавление/исключение пользователей в группы
[X] Добавление ssh ключей для пользователей
[X] Отключение ipv6 и применение настройки

## Роль bootstrap-server

В рамках данной роли:

- [x] добавляется новый сервисный пользователь
- [x] настраивается sudoers для сервисного пользователя
- [x] пользователю присваивается ключ ssh

## Роль docker

В рамках данной роли реализовано:

- [x] Загрузка публичного GPG-ключа от репо Docker и регистрация его в apt (файл docker.asc в директории /etc/apt/trusted.gpg.d)
- [x] Регистрация нового репо в apt (файл docker.sources в директории /etc/apt/sources.list.d)
- [x] установка необходимых пакетов из репо
- [x] настройка логирования в файл в формате json и установка ограничения в 3 файла по 10Mb

## Роль sshd-with-ports

В рамках данной роли реализована:

- [x] настройка службы sshd
  - [x] отключается авторизация по паролю
  - [x] включается авторизация только по ключу
  - [x] отключается авторизация пользователя root
  - [x] меняется порт службы sshd
  - [x] применяются настройки с перезапуском sshd

## Роль test

В рамках данной роли реализовано:

- [x] тестирование подключения к серверу
- [x] сбор facts для последующего использования в ролях

### Задачи для реализации

[X] Добавление и настройка пакета logrotate
[X] Добавление и настройка failt2ban и интеграция его с sshd
[X] Добавление и настройка Docker
[ ] Установка и настройка VPN-сервера
